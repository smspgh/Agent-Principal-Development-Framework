{
  "phaseNumber": 3,
  "phaseId": "ARCHITECTURE",
  "phaseName": "Architecture and Infrastructure",
  "description": "Design the technical architecture, database schema, and set up development infrastructure.",
  "primaryAgents": ["ARCHITECTURE", "DEVOPS"],
  "objectives": [
    "Design database schema and data relationships",
    "Define API contracts and architecture",
    "Establish version control and branching strategy",
    "Set up Infrastructure as Code",
    "Configure development environments and tooling"
  ],
  "steps": [
    {
      "stepId": "3.1",
      "stepName": "Design database schema and data model",
      "agentId": "ARCHITECTURE",
      "automationLevel": "full",
      "approvalRequired": false,
      "description": "Create the data model that will store and manage application data.",
      "tasks": [
        {"taskId": "3.1.1", "task": "Identify all entities and relationships (ER Diagram)", "deliverables": ["ER diagram"]},
        {"taskId": "3.1.2", "task": "Define tables, columns, data types, and constraints", "deliverables": ["Schema definition"]},
        {"taskId": "3.1.3", "task": "Establish primary keys, foreign keys, and indexes", "deliverables": ["Index strategy"]},
        {"taskId": "3.1.4", "task": "Plan for data partitioning and sharding if needed", "deliverables": ["Partitioning strategy"]},
        {"taskId": "3.1.5", "task": "Design audit logging and soft delete strategies", "deliverables": ["Audit design"]},
        {"taskId": "3.1.6", "task": "Define backup, retention, and disaster recovery strategy", "deliverables": ["Backup/DR plan"]}
      ],
      "outputs": ["Database schema", "ER diagram", "Data dictionary", "Backup strategy"],
      "agentPrompt": "Design a complete database schema based on the user stories and data requirements. Generate migration files ready for implementation. Include indexing strategy for performance."
    },
    {
      "stepId": "3.2",
      "stepName": "Design API architecture",
      "agentId": "ARCHITECTURE",
      "automationLevel": "full",
      "approvalRequired": false,
      "description": "Define how the API will be structured, versioned, and protected.",
      "tasks": [
        {"taskId": "3.2.1", "task": "Choose API paradigm (REST, GraphQL, gRPC)", "deliverables": ["API paradigm decision"]},
        {"taskId": "3.2.2", "task": "Define API versioning strategy", "deliverables": ["Versioning strategy"]},
        {"taskId": "3.2.3", "task": "Design all API endpoints, methods, and resources", "deliverables": ["API design document"]},
        {"taskId": "3.2.4", "task": "Define request/response schemas and data contracts", "deliverables": ["Data contracts"]},
        {"taskId": "3.2.5", "task": "Plan rate limiting and throttling policies", "deliverables": ["Rate limiting design"]},
        {"taskId": "3.2.6", "task": "Design API gateway requirements if applicable", "deliverables": ["Gateway design"]},
        {"taskId": "3.2.7", "task": "Document API contracts (OpenAPI/Swagger specification)", "deliverables": ["OpenAPI spec"]}
      ],
      "outputs": ["API specification", "OpenAPI documentation", "Rate limiting policy"],
      "agentPrompt": "Design a complete API following the chosen paradigm. Generate OpenAPI 3.0 specification. Include authentication, rate limiting, and error response standards."
    },
    {
      "stepId": "3.3",
      "stepName": "Define data validation and business rules",
      "agentId": "ARCHITECTURE",
      "automationLevel": "full",
      "approvalRequired": false,
      "description": "Document the business logic and validation rules that govern data.",
      "tasks": [
        {"taskId": "3.3.1", "task": "Document all business rules and constraints", "deliverables": ["Business rules document"]},
        {"taskId": "3.3.2", "task": "Define validation rules for all data inputs", "deliverables": ["Validation rules"]},
        {"taskId": "3.3.3", "task": "Create data flow diagrams", "deliverables": ["Data flow diagrams"]},
        {"taskId": "3.3.4", "task": "Define data transformation and calculation rules", "deliverables": ["Transformation rules"]},
        {"taskId": "3.3.5", "task": "Plan for data consistency and integrity checks", "deliverables": ["Integrity strategy"]}
      ],
      "outputs": ["Business rules documentation", "Validation specifications", "Data flow diagrams"],
      "agentPrompt": "Document all business rules from user stories as implementable validation logic. Define data transformations and integrity constraints. Output in a format Backend Agent can implement."
    },
    {
      "stepId": "3.4",
      "stepName": "Set up version control and branching strategy",
      "agentId": "DEVOPS",
      "automationLevel": "full",
      "approvalRequired": false,
      "description": "Establish source code management practices and collaboration workflows.",
      "tasks": [
        {"taskId": "3.4.1", "task": "Initialize Git repositories with proper structure", "deliverables": ["Git repositories"]},
        {"taskId": "3.4.2", "task": "Define branching strategy (trunk-based for solo dev)", "deliverables": ["Branching strategy document"]},
        {"taskId": "3.4.3", "task": "Set up branch protection rules", "deliverables": ["Branch protection rules"]},
        {"taskId": "3.4.4", "task": "Configure pre-commit hooks", "deliverables": ["Pre-commit config"]},
        {"taskId": "3.4.5", "task": "Set up repository templates and standards", "deliverables": ["Repo templates"]}
      ],
      "outputs": ["Git repositories", "Branching strategy", "Commit standards"],
      "agentPrompt": "Set up Git repository with trunk-based development strategy optimized for solo Agent Principal. Configure pre-commit hooks for linting and formatting."
    },
    {
      "stepId": "3.5",
      "stepName": "Define Infrastructure as Code (IaC)",
      "agentId": "DEVOPS",
      "automationLevel": "full",
      "approvalRequired": false,
      "description": "Create codified, version-controlled infrastructure definitions.",
      "tasks": [
        {"taskId": "3.5.1", "task": "Select IaC tooling (Terraform, Pulumi, etc.)", "deliverables": ["Tool selection"]},
        {"taskId": "3.5.2", "task": "Define infrastructure modules and components", "deliverables": ["IaC modules"]},
        {"taskId": "3.5.3", "task": "Create environment configurations (dev, staging, prod)", "deliverables": ["Environment configs"]},
        {"taskId": "3.5.4", "task": "Implement infrastructure version control", "deliverables": ["IaC repository"]},
        {"taskId": "3.5.5", "task": "Set up IaC testing and validation", "deliverables": ["IaC tests"]},
        {"taskId": "3.5.6", "task": "Document infrastructure architecture", "deliverables": ["Infrastructure documentation"]}
      ],
      "outputs": ["IaC codebase", "Infrastructure modules", "Environment configurations"],
      "agentPrompt": "Generate Infrastructure as Code for the selected cloud provider. Create modular, reusable components. Include configurations for all environments."
    },
    {
      "stepId": "3.6",
      "stepName": "Design containerization and orchestration",
      "agentId": "DEVOPS",
      "automationLevel": "full",
      "approvalRequired": false,
      "description": "Plan container strategy for consistent deployment across environments.",
      "tasks": [
        {"taskId": "3.6.1", "task": "Create Dockerfiles for all services", "deliverables": ["Dockerfiles"]},
        {"taskId": "3.6.2", "task": "Define container security best practices", "deliverables": ["Container security guide"]},
        {"taskId": "3.6.3", "task": "Design Kubernetes manifests or compose files", "deliverables": ["K8s manifests / compose files"]},
        {"taskId": "3.6.4", "task": "Plan service mesh requirements if applicable", "deliverables": ["Service mesh design"]},
        {"taskId": "3.6.5", "task": "Define resource limits and scaling policies", "deliverables": ["Resource policies"]},
        {"taskId": "3.6.6", "task": "Set up container registry", "deliverables": ["Container registry"]}
      ],
      "outputs": ["Container configurations", "Orchestration setup", "Container registry"],
      "agentPrompt": "Create production-ready Dockerfiles with security best practices. Generate docker-compose for local development and K8s manifests for production if applicable."
    },
    {
      "stepId": "3.7",
      "stepName": "Set up development environments",
      "agentId": "DEVOPS",
      "automationLevel": "full",
      "approvalRequired": false,
      "description": "Create consistent, reproducible development environments.",
      "tasks": [
        {"taskId": "3.7.1", "task": "Set up local development environment configuration", "deliverables": ["Dev environment setup"]},
        {"taskId": "3.7.2", "task": "Create development database seeds and fixtures", "deliverables": ["Seed data"]},
        {"taskId": "3.7.3", "task": "Configure development, staging, and production environments", "deliverables": ["Environment configurations"]},
        {"taskId": "3.7.4", "task": "Establish secrets management", "deliverables": ["Secrets management setup"]},
        {"taskId": "3.7.5", "task": "Set up development tooling (linters, formatters, pre-commit)", "deliverables": ["Dev tooling configuration"]},
        {"taskId": "3.7.6", "task": "Create developer setup documentation", "deliverables": ["Setup guide"]}
      ],
      "outputs": ["Development environment", "Secrets management", "Developer tooling"],
      "agentPrompt": "Create a complete development environment setup including docker-compose, environment variables, and seed data. Generate setup documentation for quick start."
    }
  ],
  "qualityGate": {
    "name": "architecture-ready",
    "requiredDeliverables": ["database-schema", "api-specification", "iac-templates"],
    "requiredApprovals": []
  }
}
